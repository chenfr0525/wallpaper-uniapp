{"version":3,"file":"search.js","sources":["pages/search/search.vue","D:/Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<script setup>\r\n\timport {\r\n\t\tref\r\n\t} from 'vue'\r\n\timport {\r\n\t\tapiSelectList,\r\n\t\tapiSearchWall\r\n\t} from '../../api/api.js'\r\n\timport {\r\n\t\tonReachBottom\r\n\t} from '@dcloudio/uni-app'\r\n\tconst selectList = ref([])\r\n\tconst isSearch = ref(true)\r\n\t//历史搜索\r\n\tconst historySearch = ref(uni.getStorageSync('wall-historySearch') || [])\r\n\tconst list = ref([])\r\n\t//查询参数\r\n\tconst queryParams = ref({\r\n\t\tpageNum: 1,\r\n\t\tpageSize: 12,\r\n\t\tkeyword: \"\"\r\n\t})\r\n\t//获取主题推荐\r\n\tconst getSelectList = async () => {\r\n\t\tlet res = await apiSelectList({\r\n\t\t\tselect: true\r\n\t\t})\r\n\t\tselectList.value = res\r\n\t}\r\n\r\n\t//搜索跳转\r\n\tconst search = async (item) => {\r\n\t\tqueryParams.value.keyword = item || queryParams.value.keyword\r\n\t\thistorySearch.value = [...new Set([queryParams.value.keyword, ...historySearch.value])]\r\n\t\tuni.setStorageSync('wall-historySearch', historySearch.value)\r\n\r\n\t\tgetClassifyItem()\r\n\t}\r\n\t//清理缓存\r\n\tconst deleteList = () => {\r\n\t\tuni.setStorageSync(\"wall-historySearch\", [])\r\n\t\thistorySearch.value = uni.getStorageSync('wall-historySearch')\r\n\t}\r\n\t//是否存在数据\r\n\tconst isNoData = ref(false)\r\n\tconst getClassifyItem = async () => {\r\n\t\tlet res = await apiSearchWall({\r\n\t\t\t...queryParams.value,\r\n\t\t})\r\n\t\tlist.value.push(...res)\r\n\t\tuni.setStorageSync('theme-classify', list.value)\r\n\t\tif (queryParams.value.pageSize > res.length) isNoData.value = true\r\n\t\tisSearch.value = false\r\n\t}\r\n\t//触底时继续加载\r\n\tonReachBottom(() => {\r\n\t\tif (isNoData.value) return\r\n\t\tqueryParams.value.pageNum++\r\n\t\tgetClassifyItem()\r\n\t})\r\n\r\n\t//重新搜索\r\n\tconst reSearch = () => {\r\n\t\tqueryParams.value.pageNum = 1\r\n\t\tisNoData.value = false;\r\n\t\tisSearch.value = true;\r\n\t\tlist.value = []\r\n\t}\r\n\r\n\tgetSelectList()\r\n</script>\r\n\r\n<template>\r\n\t<view class=\"searchLayout\">\r\n\t\t<view class=\"input\" @click=\"reSearch\">\r\n\t\t\t<uni-search-bar @confirm=\"search(queryParams.keyword)\" :focus=\"true\" v-model=\"queryParams.keyword\">\r\n\t\t\t</uni-search-bar>\r\n\t\t</view>\r\n\t\t<view class=\"record\" v-if=\"isSearch\">\r\n\t\t\t<record-item @startSearch=\"search\" title=\"最近搜索\" :list=\"historySearch\"\r\n\t\t\t\t:icon=\"historySearch.length!==0?true:false\" @deleteList=\"deleteList\"></record-item>\r\n\t\t\t<record-item @startSearch=\"search\" title=\"热门搜索\" :list=\"selectList\"></record-item>\r\n\t\t</view>\r\n\t\t<view class=\"classList\" v-else>\r\n\t\t\t<view class=\"content\">\r\n\t\t\t\t<navigator :url=\"'/pages/preview/preview?id='+item._id\" class=\"item\" v-for=\"item in list\"\r\n\t\t\t\t\t:key=\"item._id\">\r\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\r\n\t\t\t\t</navigator>\r\n\r\n\t\t\t</view>\r\n\t\t\t<load type=\"noMore\" v-if=\"isNoData\"></load>\r\n\t\t\t<view class=\"safe-area-inset-bottom\"></view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.searchLayout {\r\n\t\tpadding: 20rpx 30rpx;\r\n\r\n\t\t.record {\r\n\t\t\tpadding-top: 40rpx;\r\n\t\t}\r\n\r\n\t\t.classList {\r\n\t\t\t.content {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tpadding: 0 15rpx;\r\n\t\t\t\tgrid-template-columns: repeat(3, 1fr);\r\n\t\t\t\tgap: 15rpx;\r\n\r\n\t\t\t\t.item {\r\n\t\t\t\t\theight: 400rpx;\r\n\r\n\t\t\t\t\timage {\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'C:/Users/23212/Desktop/practiceCode/wallpaper-uniapp/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiSelectList","apiSearchWall","onReachBottom"],"mappings":";;;;;;;;;;;;;;;;;;AAWC,UAAM,aAAaA,cAAG,IAAC,EAAE;AACzB,UAAM,WAAWA,cAAG,IAAC,IAAI;AAEzB,UAAM,gBAAgBA,cAAAA,IAAIC,cAAAA,MAAI,eAAe,oBAAoB,KAAK,EAAE;AACxE,UAAM,OAAOD,cAAG,IAAC,EAAE;AAEnB,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAE;AAED,UAAM,gBAAgB,YAAY;AACjC,UAAI,MAAM,MAAME,sBAAc;AAAA,QAC7B,QAAQ;AAAA,MACX,CAAG;AACD,iBAAW,QAAQ;AAAA,IACnB;AAGD,UAAM,SAAS,OAAO,SAAS;AAC9B,kBAAY,MAAM,UAAU,QAAQ,YAAY,MAAM;AACtD,oBAAc,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,cAAc,KAAK,CAAC,CAAC;AACtFD,oBAAAA,MAAI,eAAe,sBAAsB,cAAc,KAAK;AAE5D,sBAAiB;AAAA,IACjB;AAED,UAAM,aAAa,MAAM;AACxBA,0BAAI,eAAe,sBAAsB,EAAE;AAC3C,oBAAc,QAAQA,oBAAI,eAAe,oBAAoB;AAAA,IAC7D;AAED,UAAM,WAAWD,cAAG,IAAC,KAAK;AAC1B,UAAM,kBAAkB,YAAY;AACnC,UAAI,MAAM,MAAMG,sBAAc;AAAA,QAC7B,GAAG,YAAY;AAAA,MAClB,CAAG;AACD,WAAK,MAAM,KAAK,GAAG,GAAG;AACtBF,oBAAAA,MAAI,eAAe,kBAAkB,KAAK,KAAK;AAC/C,UAAI,YAAY,MAAM,WAAW,IAAI;AAAQ,iBAAS,QAAQ;AAC9D,eAAS,QAAQ;AAAA,IACjB;AAEDG,kBAAAA,cAAc,MAAM;AACnB,UAAI,SAAS;AAAO;AACpB,kBAAY,MAAM;AAClB,sBAAiB;AAAA,IACnB,CAAE;AAGD,UAAM,WAAW,MAAM;AACtB,kBAAY,MAAM,UAAU;AAC5B,eAAS,QAAQ;AACjB,eAAS,QAAQ;AACjB,WAAK,QAAQ,CAAE;AAAA,IACf;AAED,kBAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpEhB,GAAG,WAAW,eAAe;"}